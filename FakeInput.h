//-----------------------------------------------------------------------------
// Fake input for ECG and PPG
//-----------------------------------------------------------------------------

#ifdef bFakeInput
//-----------------------------------------------------------------------------
const uint8_t data[] PROGMEM = {
  215, 232, 219, 187, 126, 94, 78, 85, 100, 105, 103, 101, 100, 101, 100, 100, 99, 99, 100, 102, 103,
  103, 103, 102, 102, 103, 105, 106, 106, 106, 107, 109, 112, 113, 115, 117, 121, 122, 123, 123, 126, 129,
  134, 136, 137, 137, 138, 140, 143, 142, 136, 132, 129, 127, 120, 114, 107, 107, 107, 105, 100, 98, 99,
  98, 94, 93, 93, 95, 97, 97, 97, 97, 96, 95, 96, 97, 98, 97, 96, 96, 95, 95, 94, 95,
  97, 98, 97, 96, 97, 98, 100, 101, 101, 101, 102, 102, 101, 99, 98, 98, 98, 98, 96, 95, 96,
  96, 96, 96, 96, 97, 99, 100, 101, 102, 103, 104, 104, 104, 102, 101, 102, 103, 107, 108, 107, 105,
  102, 100, 96, 93, 92, 93, 93, 93, 93, 93, 92, 90, 89, 90, 91, 90, 87, 87, 87, 85, 82,
  89, 120, 153, 202, 223, 219, 190, 125, 89, 71, 80, 96, 97, 91, 88, 90, 91, 92, 92, 94, 95,
  94, 94, 96, 98, 100, 101, 103, 104, 105, 104, 104, 105, 109, 111, 112, 112, 110, 111, 115, 120, 125,
  127, 130, 133, 137, 140, 141, 142, 143, 143, 139, 137, 136, 136, 132, 126, 117, 114, 113, 112, 106, 102,
  99, 99, 98, 96, 95, 94, 96, 96, 96, 96, 96, 95, 95, 94, 93, 91, 89, 89, 92, 94, 95,
  95, 94, 95, 97, 96, 95, 94, 93, 93, 93, 92, 92, 92, 92, 92, 91, 91, 89, 88, 88, 88,
  88, 87, 86, 85, 85, 85, 85, 86, 87, 86, 84, 83, 86, 88, 89, 87, 84, 84, 85, 85, 87,
  91, 100, 106, 110, 111, 112, 113, 117, 120, 123, 124, 125, 125, 124, 123, 121, 119, 117, 116, 114, 114,
  115, 115, 112, 110, 107, 107, 108, 109, 110, 109, 108, 108, 107, 104, 100, 100, 116, 139, 188, 223, 255,
  249, 196, 149, 99, 91, 101, 109, 111, 111, 114, 115, 113, 111, 111, 113, 115, 114, 113, 112, 112, 112,
  112, 113, 116, 117, 117, 116, 117, 117, 118, 119, 122, 124, 126, 127, 129, 132, 138, 142, 145, 146, 146,
  148, 150, 151, 149, 147, 145, 143, 138, 132, 123, 119, 117, 114, 109, 105, 102, 101, 98, 96, 95, 96,
  95, 93, 90, 90, 93, 93, 90, 88, 88, 91, 95, 95, 93, 91, 90, 91, 92, 93, 94, 93, 91,
  91, 92, 93, 93, 92, 92, 92, 91, 90, 88, 88, 89, 90, 90, 89, 90, 92, 94, 95, 93, 90,
  88, 89, 92, 93, 91, 90, 89, 89, 89, 88, 88, 88, 89, 89, 91, 93, 94, 93, 90, 90, 91,
  92, 92, 92, 91, 92, 93, 94, 95, 95, 93, 92, 91, 93, 94, 94, 94, 95, 97, 97, 97, 97,
  98, 99, 101, 103, 105, 107, 107, 107, 106, 106, 106, 105, 102, 99, 94, 93, 93, 94, 96, 97, 95,
  94, 92, 91, 91, 91, 91, 91, 93, 94, 93, 91, 89, 92, 111, 135, 187, 220, 242, 226, 164, 119,
  81, 78, 90, 96, 99, 101, 104, 105, 104, 103, 103, 104, 103, 104, 105, 106, 107, 106, 107, 106, 106,
  106, 108, 110, 112, 113, 115, 118, 120, 121, 121, 123, 127, 130, 133, 135, 140, 143, 145, 147, 149, 150,
  153, 153, 149, 144, 137, 135, 135, 133, 124, 117, 111, 111, 111, 108, 103, 102, 102, 102, 101, 99, 98,
  98, 99, 98, 97, 97, 98, 100, 102, 100, 97, 96, 95, 96, 98, 99, 98, 97, 97, 100, 104, 105,
  102, 99, 99, 101, 103, 103, 102, 101, 99, 98, 96, 96, 98, 100, 101, 99, 94, 93, 94, 95, 94,
  93, 94, 95, 97, 98, 98, 97, 95, 93, 92, 94, 97, 97, 95, 93, 91, 90, 90, 91, 92, 94,
  95, 95, 94, 93, 94, 96, 100, 101, 104, 106, 110, 112, 113, 114, 117, 118, 120, 120, 120, 121, 124,
  126, 128, 130, 131, 131, 130, 128, 127, 127, 127, 125, 123, 123, 121, 119, 116, 115, 116, 115, 112, 110,
  111, 113, 116, 116, 113, 111, 111, 111, 109, 106, 107, 117, 150, 181, 225, 239, 222, 186, 121, 93, 88,
  98, 112, 114, 114, 115, 116, 115, 112, 111, 112, 113, 114, 113, 113, 113, 114, 114, 114, 114, 116, 118,
  121, 122, 120, 118, 118, 119, 122, 124, 128, 132, 135, 136, 137, 139, 144, 146, 146, 145, 145, 147, 147,
  146, 141, 137, 130, 126, 118, 114, 109, 106, 103, 100, 97, 96, 95, 92, 88, 86, 86, 87, 88, 87,
  87, 87, 86, 85, 84, 85, 86, 87, 87, 86, 86, 87, 89, 90, 88, 87, 87, 90, 93, 94, 91,
  89, 90, 91, 91, 90, 90, 91, 92, 91, 88, 87, 87, 87, 88, 89, 89, 88, 87, 86, 86, 85,
  84, 85, 88, 90, 90, 88, 86, 87, 89, 90, 89, 88, 86, 86, 88, 90, 90, 87, 84, 84, 87,
  90, 91, 90, 89, 89, 90, 90, 90, 89, 88, 88, 90, 92, 96, 97, 97, 97, 98, 100, 102, 103,
  103, 102, 100, 99, 97, 96, 94, 93, 92, 92, 90, 89, 87, 87, 87, 88, 88, 89, 91, 91, 91,
  89, 88, 87, 85, 85, 95, 114, 160, 195, 229, 226, 181, 138, 87, 75, 81, 89, 93, 93, 95, 97,
  98, 98, 99, 99, 99, 99, 101, 102, 102, 102, 102, 104, 107, 108, 108, 108, 109, 110, 112, 112, 113,
  114, 117, 119, 122, 124, 127, 129, 134, 137, 141, 143, 145, 145, 145, 145, 145, 144, 142, 139, 133, 129,
  124, 120, 113, 109, 107, 107, 106, 105, 102, 101, 102, 103, 103, 101, 98, 96, 96, 97, 99, 100, 102,
  102, 101, 100, 100, 101, 104, 105, 106, 106, 106, 106, 104, 103, 103, 103, 103, 102, 101, 101, 103, 104,
  105, 105, 104, 103, 102, 101, 100, 100, 101, 102, 102, 101, 99, 99, 101, 101, 97, 95, 95, 97, 99,
  99, 98, 98, 98, 98, 98, 97, 97, 97, 98, 99, 99, 98, 96, 96, 95, 95, 94, 94, 96, 97,
  96, 93, 90, 91, 94, 96, 95, 94, 94, 96, 97, 97, 98, 100, 103, 104, 104, 105, 111, 115, 121,
  123, 126, 127, 128, 127, 124, 123, 124, 125, 126, 126, 125, 125, 124, 123, 122, 122, 122, 122, 120, 119,
  116, 114, 116, 125, 158, 191, 243, 255, 253, 217, 147, 114, 102, 110, 123, 125, 124, 125, 126, 125, 123,
  121, 121, 120, 120, 121, 122, 123, 123, 123, 124, 126, 129, 129, 129, 129, 130, 132, 132, 132, 132, 133,
  137, 140, 143, 146, 151, 154, 157, 159, 160, 162, 163, 164, 165, 164, 160, 155, 147, 143, 136, 130, 122,
  119, 116, 113, 106, 102, 99, 99, 99, 98, 96, 96, 96, 95, 93, 92, 92, 93, 94, 93, 93, 93,
  92, 91, 89, 89, 90, 91, 91, 92, 93, 94, 93, 91, 89, 89, 90, 91, 90, 88, 86, 85, 86,
  88, 89, 88, 88, 88, 88, 87, 84, 82, 81, 81, 82, 83, 84, 83, 81, 79, 78, 80, 81, 82,
  82, 82, 82, 82, 82, 83, 84, 84, 82, 82, 83, 85, 87, 87, 86, 86, 85, 85, 88, 90, 90,
  89, 89, 90, 91, 91, 92, 95, 100, 102, 103, 101, 96, 93, 89, 88, 86, 85, 83, 83, 85, 87,
  87, 86, 84, 82, 81, 82, 84, 85, 83, 82, 81, 81, 83, 92, 125, 159, 206, 218, 196, 160, 102,
  77, 68, 76, 91, 95, 95, 96, 96, 94, 91, 91, 95, 97, 98, 97, 97, 98, 99, 99, 99, 99,
  100, 102, 106, 108, 109, 110, 112, 114, 115, 114, 115, 117, 123, 127, 131, 133, 136, 138, 140, 140, 140,
  141, 143, 144, 142, 139, 134, 130, 124, 120, 117, 115, 112, 108, 103, 101, 100, 101, 100, 100, 98, 97,
  97, 97, 98, 99, 100, 100, 100, 100, 101, 100, 99, 99, 100, 101, 103, 104, 103, 101, 100, 100, 103,
  105, 105, 104, 102, 101, 102, 103, 103, 103, 102, 101, 100, 99, 99, 99, 98, 98, 99, 100, 100, 99,
  99, 101, 103, 103, 101, 100, 100, 102, 102, 100, 96, 94, 95, 97, 99, 100, 101, 101, 100, 99, 98,
  98, 98, 98, 98, 97, 100, 103, 107, 106, 104, 102, 105, 109, 112, 113, 111, 111, 109, 106, 100, 97,
  96, 97, 97, 97, 96, 96, 96, 95, 93, 92, 94, 95, 95, 95, 94, 92, 88, 87, 97, 114, 152,
  179, 206, 205, 169, 132, 86, 75, 84, 94, 98, 96, 96, 99, 100, 97, 92, 92, 96, 99, 99, 99,
  99, 101, 102, 102, 107, 112, 122, 126, 131, 134, 137, 138, 140, 143, 149, 151, 151, 151, 155, 160, 166,
  169, 171, 172, 173, 173, 172, 172, 173, 173, 170, 166, 159, 155, 150, 146, 140, 138, 135, 134, 131, 130,
  129, 129, 126, 123, 121, 122, 125, 125, 122, 120, 120, 121, 121, 121, 120, 120, 120, 119, 118, 118, 118,
  117, 116, 116, 116, 115, 114, 112, 111, 112, 113, 113, 110, 108, 106, 106, 107, 107, 106, 105, 104, 104,
  105, 105, 104, 104, 102, 100, 98, 99, 102, 103, 100, 96, 93, 95, 99, 99, 97, 95, 92, 91, 91,
  91, 93, 94, 94, 94, 94, 96, 99, 100, 97, 95, 95, 97, 104, 107, 106, 104, 100, 99, 98, 97,
  93, 90, 87, 86, 86, 87, 88, 88, 86, 83, 82, 82, 85, 86, 85, 83, 81, 80, 79, 82, 99,
  122, 169, 196, 203, 180, 124, 90, 67, 69, 80, 85, 88, 88, 89, 89, 87, 87, 90, 93, 96, 95,
  93, 92, 95, 98, 100, 99, 96, 95, 96, 98, 99, 99, 101, 104, 107, 108, 110, 112, 115, 116, 119,
  122, 130, 134, 135, 134, 135, 137, 137, 135, 133, 132, 131, 127, 118, 113, 108, 106, 102, 100, 96, 93,
  90, 90, 91, 91, 89, 87, 87, 88, 92, 92, 90, 88, 90, 92, 95, 94, 89, 87, 88, 91, 95,
  95, 94, 93, 92, 92, 92, 93, 95, 97, 97, 97, 97, 98, 97, 96, 95, 93, 91, 90, 90, 91,
  92, 93, 94, 95, 95, 94, 92, 92, 92, 93, 94, 94, 93, 93, 94, 94, 94, 93, 92, 93, 93,
  93, 92, 92, 93, 95, 97, 98, 99, 100, 100, 102, 106, 109, 111, 111, 107, 103, 99, 99, 99, 97,
  93, 92, 93, 94, 93, 92, 92, 93, 93, 93, 92, 92, 91, 89, 87, 87, 88, 91, 113, 143, 199,
  226, 223, 191, 125, 90, 71, 77, 92, 98, 98, 96, 96, 98, 98, 96, 96, 97, 100, 100, 100, 101,
  104, 106, 107, 106, 106, 107, 108, 108, 109, 109, 111, 114, 118, 120, 122, 123, 126, 128, 131, 133, 138,
  140, 144, 146, 149, 150, 149, 147, 144, 143, 142, 139, 130, 124, 117, 115, 112, 111, 109, 107, 102, 99,
  96, 96, 100, 101, 99, 97, 97, 98, 100, 99, 98, 97, 98, 98, 99, 100, 103, 103, 102, 101, 101,
  102, 102, 102, 102, 102, 102, 102, 103, 104, 103, 102, 103, 107, 114, 119, 124, 125, 126, 125, 123, 124,
  124, 124, 123, 123, 124, 126, 129, 130, 128, 127, 127, 127, 127, 127, 126, 126, 125, 124, 122, 122, 124,
  126, 126, 126, 126, 127, 129, 130, 132, 134, 136, 135, 133, 132, 129, 126, 120, 117, 115, 114, 112, 110,
  109, 108, 107, 106, 105, 105, 105, 106, 107, 106, 101, 97, 94, 98, 120, 148, 204
};

uint8_t getdata(int i) {
  return pgm_read_byte_near(data + i);
}

uint16_t XanalogRead(int pin) {
  static int t = 0;
  #ifdef bHasPPG
    if (pin == PPG_IN) {
      int j,k;
      static float a = 128;
      static float b = 128;
      static float c = 128;
      static float Delay = 35;
      static float dDelay = 0.01;
    
      Delay = Delay + dDelay;
      if (Delay > 40)
        dDelay = -0.0001*random(100);
      if (Delay < 35)
        dDelay = +0.0001*random(100);
    
      if (t == (int)Delay)
        a = 240; else
      if (t == (int)Delay+35)
        a = 200; else
        a = a + (128-a)/20;
      b = b + (a-b)/8;
      c = c + (b-c)/8;
      return c;
    } 
  #endif

  static float Rate = 1;
  static float dRate = 0.001;
  static int i = 0;
  static float f = 0;

  Rate = Rate + dRate;
  if (Rate > 2)
    dRate = -0.00001*random(100);
  if (Rate < 0.8)
    dRate = +0.00001*random(100);

  f = f+Rate;
  i = (int)f % sizeof(data);

  t++;
  if (getdata(i) > 200)
    t = 0;

  return min(getdata(i)*4,1023);
}
#endif
